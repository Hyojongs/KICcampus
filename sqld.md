# 데이터 모델링 (Data Modeling)

## 데이터 모델링의 이해

### 데이터 모델링의 특징
- 추상화(Abstraction) : 현실세계를 간략하게 표헌한다.
- 단순화(Simplification) : 누구나 쉽게 이해할 수 있도록 표현
- 명확성(Clarity) : 명확하게 의미가 해석되어야 하고 한가지 의미를 가져야 한다.

### 데이터 모델링의 단계
- `개념적 모델링`
    - 전사적 관점에서 기업의 데이터를 모델링
    - 추상화 수준이 가장 높은 모델링
    - 업무 측면에서 모델링
- `논리적 모델링`
    - 정규화를 통해 재사용성을 높인다.
    - 식발자를 정의하고 관계, 속성등을 모두 표현

- `물리적 모델링`
    - 성능, 보안, 가용성 등을 고려하여 데이터베이스 구축
### 데이터 모델링의 관점
- 데이터 
- 프로세스
- 데이터와 프로세스

### 데이터 모델링을 위한 ERD 작성 절차
1. 엔터티를 도출하고 그린다.
2. 엔터티를 배치한다.
3. 엔터티간의 관계를 설정한다.
4. 관계명을 서술한다.
5. 관계 참여도를 표현
6. 관계의 필수 여부를 표현한다.

## 3층 스키마(3-Level Schema)

### 3층 스키마
- 데이터베이스의 독립성을 확보하기 위한 방법이다.
- 독립성 확보하면 데이터 복잡도 감소, 데이터 중복 제거, 사용자 요구 사항 변경에 따른 대응혁 향상, 관리 밑 유지보수 비용 절감등의 장점이 있다.
- 각 계층을 view라고 한다.
### 3층 스키마의 독립성
- 논리적 독립성 : 개념 스키마가 변경되도 외부 스키마에 영향을 받지 않는다.
- 물리적 독립성 : 내부 스키마가 변경되도 개념 스키마가 영향을 받지 않는다.

### 3층 스키마의 구조
- `외부스키마` 
    - 사용자 관점 업무상 관련이 있는 데이터 접근
    - 응용 프로그램이 접근하는 데ㅐ이터베이스를 정의
- `개념스키마`
    - 통합 데이터베이스 구조
    - 전체 데이터베이스 내의 규칙과 구조를 표현
- `내부스키마`
    - 물리적 저장구조

## 엔터티(ENtity)
### 엔터티의 의미
- 업무에서 관리해야하는 데이터 집합, 저장되고 관리되어야 하는 데이터

### 엔터티의 특징
- 식별자 : 유일한 식별자가 있어야 한다.
- 인스턴스 집합 : 2개 이상의 인스턴스가 있어야 한다.
- 속성 : 엔터티는 반드시 속성을 가지고 있다.
- 관계 : 다른 엔터티와 회소한 한 개 이상의 관계가 있어야한다.
- 업무 : 업무에서 관리되어야 하는 집합이다.

## 엔터티의 종류

### 유형과 무형에 따른 엔터티 종류
- `유형 엔터티` : 업무에 도출되며 지속적으로 사용되는 엔터티
- `개념 엔터티` : 유형은 물리적 형태가 있지만 개념엔터티는 없다, 개념적으로 사용됨
- `사건 엔터티` : 비즈니스 프로세스를 실행하면서 생성되는 엔터티

### 발생 시점에 따른 엔터티 종류
- `기본 엔터티` : 키 엔터티라고도 한다. 다른 엔터티로부터 영향을 받지않고 독립적으로 생성된다.
- `중심(main) 엔터티` : 기본엔터티로부터 발생되고 행위 엔터티를 생성함.
- `행위 엔터티` : 2개 이상의 엔터티로부터 발생된다.


## 속성(Attribute)
- 더 이상 분리되지 않는 단위
- 인스턴스의 구성요소이고 의미적으로 더 이상 분해되지 않는다.

### 속성의 특징
- 속성은 하나의 값만 가진다.
- 주식별자에게 함수적으로 종속된다, 즉 기본키가 변경되면 속성의 값도 변경

### 분해여부에 따른 속성의 종류

- `단일속성` : 하나의 의미를 구성하는 것
- `복합속성` : 여러개의 의미가 있는것이다.
- `다중값 속성` : 속성에 여러 개의 값을 가질 수 있는 것
### 특성에 따른 속성의 종류
- `기본 속성` : 비지니스 프로세스에서 도출되는 본래의 속성
- `설계 속성` : 데이터 모델링 과정에서 발생되는 속성, 유일한 값을 부여함
- `0파생 속성` : 다른 속성에 의해서 만들어지는 속성

## 관계(Relationship)
- 엔터티관의 관련성을 의미하며 존재 관계와 행위 관계로 분류

### 관계의 종류
- 존재 관계 
    - 언터티간의 상태를 의미한다.
- 행위 관계
    - 엔터티간에 어떤 행위가 있는 것

### 관계 차수(Relation Cardinality)
- 1 대 1 관계
    - 완전 1대1 : 하나의 엔터티에 관계되는 엔터티의 관계가 하나인경우로, 반드시 존재
    - 선택적 1대1 : 하나의 엔터티에 관계되는 엔터티의 관계가 하나거나 없다.
- 1대 N 관계 : 하나의 행에 다른 엔터티 값이 여러개가 있을 때
- M 대 N 관계 
    - 두개 엔터티가 서로 여러 관계를 가지고 있을때
    - 카타시안 곱이 발생한다.
- 필수적 관계 : 반드시 하나는 존재해야하는 관계로 `|`로 표현
- 선택적 관계 : 없을 수도 있는 관계로 `O`로 표현

### 식별관계와 비식별관계
- 식별관계
    - 강한개체에 기본키를 기본키로써 공유하는 것
    - 실선으로 표시

- 비식별관계
    - 강한개체의 기본키를 다른 엔터티의 기본키가 아닌 일반 칼럼으로 관계를 가지는 것
    - 점선으로 표시

## 엔터티 식별자

### 주식별자(기본키)
- 최소성, 대표성, 유일성, 불변성

### 키의 종류
- 기본키(primary key) : 후보키 중에서 인터티를 대표할 수 있는키
- 후보키 : 유일성과 최소성을 만족하는 키
- 슈퍼키 : 유일성은 만족하지만 최소성을 만족하지 않는 키
- 대체키 : 여러개의 후보키 중 기본키를 선정하고 남은 키
- 외래키 : 하나 혹은 다슈ㅜ의 다른 테이블의 기본키필드를 가리키는 것으로, 참조 무결성을 확인하기 위해 사용

### 대표성에 따른 식별자의 종류
- 주식별자 : 유일성과 최송성을 만족하면서 엔터티를 대표하는 식별자, 다른 엔터티와 참조관계로 연결가능
- 보조식별자 : 유일성과 최소성은 만족하지만 대쵸성을 만족하지 못하는 식별자

### 생성여부에 따른 식별자
- 내부 식별자 : 엔터티 내부에서 스스로 생성되는 식별자
- 외부 식별자 : 다른 엔터티와의 관계로 인하여 만들어지는 식별자

### 속성의 수에 따른 식별자 종류
- 단일 식별자 : 하나의 속성으로 구성된다.
- 복합 식별자 : 두 개 이상의 속성으로 구성된다.

### 대체여부에 따른 식별자의 종류
- 본질 식별자 : 비지니스 프로세스에서 만들어지는 식별자
- 인조 식별자 : 후보식별자 중에서 주식별자로 선정할 것이 없거나 주식별자가 너무 많은 칼럼으로 되어 있는 경우에 사용한다. 즉 순서번호를 사용해서 식별자를 만든다.


# 데이터 모델과 성능
## 정규화
- 데이터의 일관성, 최소한의 데이터 중복, 최대한의 데이터 유연성을 위한 방법이며 데이터를 분해하는 과정
- 데이터 중복을 제거하고 모델의 독립성을 확보하기 위한 방법

### 제1정규화
- 속성의 원자성을 확보한다.
- 기본키를 설정한다.

### 제2정규화
- 기본키가 2개 이상의 속성으로 이루어진 경우, 부분 함수 종속성을 제거한다.

### 제3정규화
- 기본키를 제외한 칼럼 간에 종속성을 제거한다.
- 즉 이행 함수 종속성을 제거한다.

### BCNF
- 기본키를 제외하고 후보키가 있는 경우, 후보키가 기본키를 종속시키면 분해한다.
- 복수의 후보키가 있고, 후보키는 복합 속성이여야하며 서로 중첩되어야한다.

## 정규화의 성능

### 정규화의 문제점
- 정규화는 데이터 조회시 join을 유발하기에 CPu와 메오리를 많이 사용함.
- 이러한 성능저하를 해결하기 위해 반정규화가 있다.


## 반정규화
- 데이터 중복을 허용하고 조인을 줄이는 방법
- 조회 속도를 향상하지만 데이터 모델의 유연성을 낮아진다.
### 반정규화를 수행하는 경우
- 정규화에 충실하면 중속성, 활용성은 향상되지만 수행 속도가 느려지는 경우
- 다량의 범위를 처리해야 하는 경우
- 특정 범위의 데이터만 자주 처리하는 경우
- 요약/집계정보가 자주 요구되는 경우

### 반정규화 기법
- 계산된 칼럼 추가
- 테이블 수직 분활 : 칼럼을 분할하여 새로운 테이블을 만듬
- 테이블 수평 분활 : 값을 기준으로 테이블 분할
    - 파티션 기법
        - Range partition : 데이터 값의 범위를 기준으로 파티션을 수행한다.
        - List Partition : 특정한 값을 지정해서 파티션 수행
        - Hash Partition : 해시 함수를 적용하여 파티션을 수행한다.
        - Composite Partition : 범위와 해시를 복합적을 사용하여 파티션
- 테이블 병합 : 1대1 관계의 테이블을 하나로 병합해서 성능을 향상
    - 슈퍼타입과 서브타입관계가 발생하면 테이블을 통합하여 성능 향상시킴
    - 슈퍼 타입 및 서브타입 변환 방법
        - OneToOne Tyoe  
            - 슈퍼타입과 서브타입을 개별 테이블로 도출
            - 테이블의 수가 많아서 조인이 많이 발생하고 관리가 어렵다,
        - Plus Type
            - 슈퍼타입과 서브타입 테이블로 도출한다.
            - 조인이 발생하고 관리가 어렵다.
        - Single Type
            - 슈퍼타입과 서브타입을 하나의 테이블로 도출
            - 조인성능이 좋고 관리가 편리하지만 입출력 성능이 나쁘다.
## 분산데이터베이스
### 데이터베이스의 구조
- 중앙 집중형 데이터베이스 : 한대의 물리적 시스템에 데이터베이스 관리 시스템을 설치하고 여러명의 사용자가 데이터베이스 관리 시스템에 접속해 데이터 베이스를 사용하는 구조
- 분산 데이터베이스 : 물리적으로 떨어진 데이터베이스에 네트워크로 연결하여 단일 데이터베이스 이미지를 부여주고 분산된 작업 처리를 수행하는 데이터베이스

### 분산 데이터베이스의 투명성
- 분할 투명성 
- 위치 투명성
- 지역 사상 투명성
- 중복 투명성
- 장애 투명성
- 병행 투명성

### 분산 데이터 베이스 설계 방식
- 상향식 설계 방식 : 지역 스키마 작성후 향후 전역 스키마를 작성하여 분산 데이터베이스 구축
- 하향식 설계 방식 : 전역 스키마 작성 후 해당 지역 사상 스키마를 작성하여 분산 데이터베이스를 구축한다.

### 분상 데이터베이스 장점과 단점
- 장점
    - 신뢰성과 가용성이 높다.
    - 빠른 응답이 가능
    - 용량 확정이 쉽다.
- 단점
    - 관리와 통제가 어렵다.
    - 보안관리가 어렵다.
    - 데이터 무결성 관리가 어렵다.
    - 데이터 베이스 설꼐가 어렵다

# SQL 기본

## 관계형 데이터베이스
### 데이터베이스의 종류
- 계층형 데이터 베이스 : tree구조로 1대 N관계를 표현
- 네트워크 데이터베이서 : 1대N 관계 및 M대N관계도 표현이 가능
- 관계형 데이터베이스 : 릴레이션에 데이터를 저장하고 관리한다.

### 관계형 데이터베이스 집합연산과 관계연산
- 집합 연산
    - 합집합
        - 2개의 릴레이션을 하나로 합하는 것
        - 중복된 행(듀플)은 한번만 조회한다.
    - 차집합
        - 본래 릴레이션에는 존재하고 다른 릴레이션에는 존재하지 않는 것을 조회함.
    - 교집합 : 두 릴레이션 간에 공통된 것 찾기
    - 곱집합 : 각릴레이션에 존재하는 모든 데이터를 조합해 연산
- 관계연산
    - 선택연산 : 조건에 맞는 듀플만을 조회
    - 투영연산 : 릴레이션에서 조건에 맞는 속성만을 조회
    - 결합연산(join) : 여러 릴레이션의 공통된 속성을 사용해 새로운 릴레이션을 만듬
    - 나누기 연산
### 테이블의 구조
- 기본키 : 하나의 테이블에서 유일성과 최소성, not null을 만족하는 것
- 행과 칼럼으로 구성되어있다.
- 칼럼은 어떤 ㅈ데이터를 저장하기 위한 필드로 속성이라고도 부름
- 외래키는 다른 테이블의 기본키를 참조하는 칼럼

## SQL의 종류
- DDL(Data Definition Language)
- DML (Data Manipulation Language)
- DCL(Data Control Language)
- TCL(Transaction Control Language) 

### 트랜젝션(Transaction)
- 트랜잭션은 데이터베이스의 작업을 처리하는 단위
- 특성
    - 원자성
        - 트랜잭션은 데이터베이스 연산의 전부가 실행거나 실행되지 않아야한다.
        - 트랜잭션의 처리가 완전히 끝나지 않았을 경우는 실행되지 않은 상태와 같아야한다.
    - 일관성
        - 실행결과로 데이터베이스의 상태가 모순되지 않아야한다.
    - 고립성
        - 실행중에 생성하는 연산의 중간결과는 다른 트랜잭션이 접근할 수 없다.
        - 부분적인 실행결과를 다른 트랜잭션이 볼 수 없다.
    - 영속성 
        - 트랜잭션이 그 실행을 성공적으로 완료하면 그 결과는 영구적 보장이 되어야한다.
### SQL문의 실행 순서
1. 파싱(Parsing) : 문법을 확인하고 구문 분석
2. 실행(Execution) : 옵티마이저가 수립한 실행계획에 따라 SQL을 실행
3. 인출(Fetch) : 데이터를 읽어서 전송
